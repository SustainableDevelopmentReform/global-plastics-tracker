<!DOCTYPE html>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<title>Table view | Global plastics tracker</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="preload" as="style" href="https://fonts.googleapis.com/css2?family=Source+Serif+Pro:ital,wght@0,400;0,600;0,700;1,400;1,600;1,700&amp;display=swap" crossorigin>
<link rel="preload" as="style" href="./_observablehq/theme-air,near-midnight.css">
<link rel="preload" as="style" href="./_observablehq/stdlib/inputs.css">
<link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css2?family=Source+Serif+Pro:ital,wght@0,400;0,600;0,700;1,400;1,600;1,700&amp;display=swap" crossorigin>
<link rel="stylesheet" type="text/css" href="./_observablehq/theme-air,near-midnight.css">
<link rel="stylesheet" type="text/css" href="./_observablehq/stdlib/inputs.css">
<link rel="modulepreload" href="./_observablehq/client.js">
<link rel="modulepreload" href="./_observablehq/runtime.js">
<link rel="modulepreload" href="./_observablehq/stdlib.js">
<link rel="modulepreload" href="./_npm/d3-dsv@3.0.1/_esm.js">
<link rel="modulepreload" href="./_npm/htl@0.3.1/_esm.js">
<link rel="modulepreload" href="./_observablehq/stdlib/inputs.js">
<link rel="modulepreload" href="./_npm/isoformat@0.2.1/_esm.js">
<link rel="icon" href="./_file/data/csdr.bdd05e74.png" type="image/png" sizes="32x32">
<script type="module">

import {define} from "./_observablehq/client.js";
import {registerFile} from "./_observablehq/stdlib.js";

registerFile("./data/global_plastics_waste_data_links_current.csv", {"name":"./data/global_plastics_waste_data_links_current.csv","mimeType":"text/csv","path":"./_file/data/global_plastics_waste_data_links_current.190d3a8a.csv","lastModified":1745479301357});
registerFile("./data/global_plastics_waste_data_ratings_current.csv", {"name":"./data/global_plastics_waste_data_ratings_current.csv","mimeType":"text/csv","path":"./_file/data/global_plastics_waste_data_ratings_current.390554c9.csv","lastModified":1745479301357});

define({id: "b78fd37c", inputs: ["FileAttachment"], outputs: ["plastics_ratings_raw","plastics_links_raw"], body: (FileAttachment) => {
// load the plastics data
const plastics_ratings_raw = FileAttachment("./data/global_plastics_waste_data_ratings_current.csv").csv({typed: true});
// load the corresponding links data
const plastics_links_raw = FileAttachment("./data/global_plastics_waste_data_links_current.csv").csv({typed: false}); // URLs are strings
return {plastics_ratings_raw,plastics_links_raw};
}});

define({id: "a88ccfbb", inputs: ["htl"], outputs: ["valueColorMap","scoreLegend"], body: (htl) => {
const valueColorMap = {
  0: "#D3D3D3", 1: "#FFDAB9", 2: "#FFD8B1",
  3: "#FFFFE0", 4: "#98FB98", 5: "#008000"
};

const scoreLegend = htl.html`<div class="color-legend-wrapper">
  <div class="color-legend">
    <strong class="legend-title">Data score colour coding:</strong>
    ${Object.entries(valueColorMap)
      .sort(([scoreA], [scoreB]) => parseInt(scoreA) - parseInt(scoreB)) // Sort scores numerically
      .map(([score, color]) => htl.html`
      <div class="legend-item">
        <span class="legend-swatch" style="background-color: ${color};"></span>
        <span class="legend-label">${score}</span>
      </div>
    `)}
  </div>
</div>`;
return {valueColorMap,scoreLegend};
}});

define({id: "b771a423", inputs: ["plastics_ratings_raw","Inputs","view","plastics_links_raw"], outputs: ["plastics_ratings_all_rows","tableSearch","tableSearchValue","numericColumnsToColorAndLink"], body: (plastics_ratings_raw,Inputs,view,plastics_links_raw) => {
// This is the full, mapped array of all rating objects from your CSV.
// It will be used to find the original index of rows shown in the filtered table.
const plastics_ratings_all_rows = plastics_ratings_raw.map((d) => ({
  "Country": d["Country"], // Crucial: Ensure this key matches your CSV header for country
  "Region": d["Region"],
  "Type": d["Type"],
  "Domestic primary material": +d["Domestic primary material"],
  "Domestic Products": +d["Domestic Products"],
  "Virgin content consumption": +d["Virgin content consumption"],
  "Recycled content consumption": +d["Recycled content consumption"],
  "Primary material trade (imports)": +d["Primary material trade (imports)"],
  "Primary material trade (exports)": +d["Primary material trade (exports)"],
  "Products (imports)": +d["Products (imports)"],
  "Products (exports)": +d["Products (exports)"],
  "Total generated plastic waste": +d["Total generated plastic waste"],
  "Waste recovered for recycling": +d["Waste recovered for recycling"],
  "Waste to Energy": +d["Waste to Energy"],
  "Waste Incinerated (without energy recovery)": +d["Waste Incinerated (without energy recovery)"],
  "Waste landfilled": +d["Waste landfilled"],
  "Waste (import)": +d["Waste (import)"],
  "Waste (Export)": +d["Waste (Export)"]
}));

// Create search input using the full ratings data
const tableSearch = Inputs.search(plastics_ratings_all_rows, {placeholder: "Search table..."});
const tableSearchValue = view(tableSearch); // This filtered/sorted array is passed to Inputs.table


// Column names that will be colored and should get links.
// These names must match the keys in plastics_ratings_all_rows objects
// AND the column headers in your links CSV.
const numericColumnsToColorAndLink = [
  "Domestic primary material", "Domestic Products", "Virgin content consumption",
  "Recycled content consumption", "Primary material trade (imports)",
  "Primary material trade (exports)", "Products (imports)", "Products (exports)",
  "Total generated plastic waste", "Waste recovered for recycling", "Waste to Energy",
  "Waste Incinerated (without energy recovery)", "Waste landfilled",
  "Waste (import)", "Waste (Export)"
];

// DEBUG: Verify plastics_links_raw structure (optional, but good for a first run)
if (plastics_links_raw && plastics_links_raw.length > 0) {
    console.log("BLOCK 2 DEBUG: First row of plastics_links_raw:", JSON.parse(JSON.stringify(plastics_links_raw[0])));
    console.log(`BLOCK 2 DEBUG: plastics_links_raw has ${plastics_links_raw.length} rows. plastics_ratings_all_rows has ${plastics_ratings_all_rows.length} rows.`);
    if (plastics_ratings_all_rows.length !== plastics_links_raw.length) {
        console.warn("WARNING: Row count mismatch between ratings data and links data!");
    }
} else {
    console.warn("BLOCK 2 DEBUG: plastics_links_raw is empty or undefined.");
}
return {plastics_ratings_all_rows,tableSearch,tableSearchValue,numericColumnsToColorAndLink};
}});

define({id: "abb22477", inputs: ["plastics_ratings_all_rows","view","Inputs"], outputs: ["colNames","startList","selectedColumns"], body: (plastics_ratings_all_rows,view,Inputs) => {
// create column toggle list
const colNames = Object.keys(plastics_ratings_all_rows[0])
const startList = ["Country", "Domestic primary material", "Domestic Products", "Primary material trade (imports)", "Primary material trade (exports)", "Total generated plastic waste"]
const selectedColumns = view(Inputs.checkbox(colNames, {
  label: "Columns to display",
  value: startList,
  multiple: true}))
return {colNames,startList,selectedColumns};
}});

define({id: "e10780b0", body: () => {
// if not using the view wrapper above, then you need the generator
//const selectedColumns = Generators.input(selectedColumns);
//Then use this html in the appropriate section
//<div> 
//${selectedColumnsInput}
//</div>
}});

define({id: "05498177", inputs: ["plastics_ratings_all_rows","plastics_links_raw","numericColumnsToColorAndLink","valueColorMap"], outputs: ["createStyledCell","tableCellFormats"], body: (plastics_ratings_all_rows,plastics_links_raw,numericColumnsToColorAndLink,valueColorMap) => {
// --- Table Cell Formatting Logic ---

function createStyledCell(value, {backgroundColor = 'transparent', textAlign = 'left', padding = '5px 8px'} = {}) {
  const span = document.createElement("span");
  span.style.backgroundColor = backgroundColor;
  if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
    span.style.color = '#f0f0f0';
  } else {
    span.style.color = 'black';
  }
  span.style.padding = padding;
  span.style.display = "block";
  span.style.borderRadius = "4px";
  span.style.textAlign = textAlign;
  span.textContent = String(value);
  return span;
}

const tableCellFormats = {};
// Ensure plastics_ratings_all_rows is used for checks if plastics_links_raw is also checked against its length
if (plastics_ratings_all_rows.length > 0 && plastics_links_raw && plastics_links_raw.length > 0) {
  const allColumnNamesFromData = Object.keys(plastics_ratings_all_rows[0]);
  const firstRatingRow = plastics_ratings_all_rows[0]; // To check data types for non-linkable numeric cols

  // Optional: You can re-add the column name matching diagnostics here if still needed

  for (const colName of allColumnNamesFromData) {
    if (numericColumnsToColorAndLink.includes(colName)) {
      tableCellFormats[colName] = (cellValue, i_filtered, rowData_filtered) => {
        // Step 1: Create the styled span (rating number with background)
        let styledContentSpan;
        if (typeof cellValue === 'number' && valueColorMap[cellValue] !== undefined) {
          styledContentSpan = createStyledCell(cellValue, {backgroundColor: valueColorMap[cellValue], textAlign: 'center'});
        } else if (typeof cellValue === 'number') {
          styledContentSpan = createStyledCell(cellValue, {textAlign: 'center'});
        } else {
          styledContentSpan = createStyledCell(String(cellValue), {textAlign: 'left'});
        }

        // Step 2: Find the original index of this rowData_filtered in plastics_ratings_all_rows
        const originalRowIndex = plastics_ratings_all_rows.findIndex(originalRow => originalRow === rowData_filtered);

        let url = null;
        if (originalRowIndex !== -1) {
          // Check if the corresponding row and column exist in plastics_links_raw
          const linkRow = plastics_links_raw[originalRowIndex];
          if (linkRow && linkRow.hasOwnProperty(colName)) {
            url = String(linkRow[colName]).trim();
          } else if (i_filtered < 2 && colName === numericColumnsToColorAndLink[0]) { // Log for first few cells of first linkable column
            console.warn(`Link lookup: For original index ${originalRowIndex}, column '${colName}' not found or linkRow missing in plastics_links_raw. LinkRow:`, linkRow);
          }
        } else if (i_filtered < 2 && colName === numericColumnsToColorAndLink[0]) {
            console.warn(`Link lookup: Could not find original index for rowData:`, rowData_filtered);
        }

        // Step 3: If URL is valid, create anchor tag
        if (url && url !== "" && (url.startsWith('http://') || url.startsWith('https://'))) {
          const anchor = document.createElement('a');
          anchor.href = url;
          anchor.target = "_blank";
          anchor.rel = "noopener noreferrer";
          anchor.style.display = "block"; 
          anchor.style.textDecoration = "none";
          anchor.style.color = "inherit"; 
          anchor.appendChild(styledContentSpan);
          return anchor;
        } else {
          // If URL is invalid or not found, log it for first few relevant cells.
          if (url && url !== "" && i_filtered < 2 && colName === numericColumnsToColorAndLink[0]) {
              console.warn(`Invalid URL format for original index ${originalRowIndex}, col '${colName}': '${url}'`);
          }
          return styledContentSpan; // Return just the styled number
        }
      };
    } else if (typeof firstRatingRow[colName] === 'number') {
      // For other numeric columns not in numericColumnsToColorAndLink
      tableCellFormats[colName] = (cellValue) => createStyledCell(cellValue, {textAlign: 'right'});
    } else {
      // For text columns like "Country", "Region", "Type"
      tableCellFormats[colName] = (cellValue) => createStyledCell(cellValue, {textAlign: 'left'});
    }
  }
} else {
  console.warn("Block 4: plastics_ratings_all_rows or plastics_links_raw is empty. No table cell formats created or links will be missing.");
}
return {createStyledCell,tableCellFormats};
}});

define({id: "d2bb0119", inputs: ["view","Inputs","tableSearchValue","selectedColumns","tableCellFormats"], outputs: ["finalTable"], body: (view,Inputs,tableSearchValue,selectedColumns,tableCellFormats) => {
const finalTable = view(Inputs.table(tableSearchValue, { // tableSearchValue is the filtered/sorted data
  rows: 15,
  columns: selectedColumns,
  format: tableCellFormats,
  width: "100%"
}));
return {finalTable};
}});

define({id: "340c6cae", inline: true, inputs: ["scoreLegend","display"], body: async (scoreLegend,display) => {
display(await(
scoreLegend
))
}});

define({id: "b93f214c", inputs: ["view","Inputs"], outputs: ["downloadButton"], body: (view,Inputs) => {
const downloadButton = view(Inputs.button("Download the data (coming soon...)"))
return {downloadButton};
}});

</script>
<input id="observablehq-sidebar-toggle" type="checkbox" title="Toggle sidebar">
<label id="observablehq-sidebar-backdrop" for="observablehq-sidebar-toggle"></label>
<nav id="observablehq-sidebar">
  <ol>
    <label id="observablehq-sidebar-close" for="observablehq-sidebar-toggle"></label>
    <li class="observablehq-link"><a href="./">Global plastics tracker</a></li>
  </ol>
  <ol>
    <li class="observablehq-link"><a href="./1_about">About</a></li>
    <li class="observablehq-link observablehq-link-active"><a href="./2_tables">Table view</a></li>
    <li class="observablehq-link"><a href="./3_map">Map view</a></li>
    <li class="observablehq-link"><a href="./4_resources">Resources</a></li>
    <li class="observablehq-link"><a href="./5_contribute">Contribute data &amp; feedback</a></li>
  </ol>
</nav>
<script>{Object.assign(document.createElement("a"),{href:""}).password&&location.replace(location.href);const e=document.querySelector("#observablehq-sidebar"),t=document.querySelector("#observablehq-sidebar-toggle"),r=sessionStorage.getItem("observablehq-sidebar");r?t.checked=r==="true":t.indeterminate=!0;for(const o of document.querySelectorAll("#observablehq-sidebar summary")){const s=o.parentElement;switch(sessionStorage.getItem(`observablehq-sidebar:${o.textContent}`)){case"true":s.open=!0;break;case"false":s.classList.contains("observablehq-section-active")||(s.open=!1);break}}addEventListener("beforeunload",()=>sessionStorage.setItem("observablehq-sidebar-scrolly",`${e.scrollTop}`));const a=sessionStorage.getItem("observablehq-sidebar-scrolly");a!=null&&(e.style.cssText="overflow: hidden;",e.scrollTop=+a,e.style.cssText="");}</script>
<aside id="observablehq-toc" data-selector="h1:not(:first-of-type), h2:first-child, :not(h1) + h2">
<nav>
</nav>
</aside>
<div id="observablehq-center">
<main id="observablehq-main" class="observablehq">
<h1 id="table-view" tabindex="-1"><a class="observablehq-header-anchor" href="#table-view">Table view</a></h1>
<div id="cell-b78fd37c" class="observablehq observablehq--block"></div>
<div id="cell-a88ccfbb" class="observablehq observablehq--block"></div>
<div id="cell-b771a423" class="observablehq observablehq--block"></div>
<div id="cell-abb22477" class="observablehq observablehq--block"></div>
<div id="cell-e10780b0" class="observablehq observablehq--block"></div>
<div id="cell-05498177" class="observablehq observablehq--block"></div>
<div id="cell-d2bb0119" class="observablehq observablehq--block"></div>
<p><span id="cell-340c6cae" class="observablehq--loading"></span></p>
<div id="cell-b93f214c" class="observablehq observablehq--block"></div>
<style>
  /* Add these styles to your existing <style> block or create a new one */

  .color-legend-wrapper {
    margin-bottom: 1.5rem; /* Space below the legend, before the table controls/table */
    /* max-width: 700px; /* Optional: constrain width of legend container */
  }

  .color-legend {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 0.5rem 1rem; /* Vertical gap, Horizontal gap between items */
    font-family: var(--sans-serif, system-ui, sans-serif);
    font-size: 0.9em;
    padding: 0.75rem 1rem;
    background-color: var(--theme-background-alt);
    border: 1px solid var(--theme-background);
    border-radius: var(--theme-radius, 4px);
  }

  .legend-title {
    font-weight: 600;
    margin-right: 0.5rem;
    color: var(--theme-foreground);
  }

  .legend-item {
    display: flex;
    align-items: center;
    gap: 0.4em; /* Space between swatch and label */
  }

  .legend-swatch {
    display: inline-block;
    width: 16px;
    height: 16px;
    border: 1px solid var(--theme-foreground-faint, #bbb); /* Border for light swatches */
    border-radius: 3px;
  }

  .legend-label {
    color: var(--theme-foreground-muted, #333);
  }
</style>
<div class="small note">The Global Plastics Data tracker provides easy access to the sources of individual data points for each country, across the whole supply-chain.  The Tracker refers only to Government published data and statistics for all aspects of the supply-chain. Each data point has been assigned a “Data score” which indicates how suitable the data is for informing annual flows of plastic in the country. The highest data scores are assigned to the data points that report plastic-specific data and are reported annually. Lower data scores are given to data points that do not publish plastic-specific data, and/or have published data infrequently.<br>The tracker was developed via a rapid assessment in the run up to INC-5 - the analysts therefore welcome users to improve the sources and provide feedback. <br>Each rating has a link to the original source of information. For feedback, updates or help, please email <a href="mailto:helena.dickinson@unsw.edu.au" target="_blank" rel="noopener noreferrer">Helena Dickinson</a> or <a href="mailto:e.northrop@unsw.edu.au" target="_blank" rel="noopener noreferrer">Eliza Northrop</a>.</div></main>
<footer id="observablehq-footer">
<nav><a rel="prev" href="./1_about"><span>About</span></a><a rel="next" href="./3_map"><span>Map view</span></a></nav>
<div>Built with <a href="https://observablehq.com/" target="_blank" rel="noopener noreferrer">Observable</a> on <a title="2025-05-16T01:47:42">May 16, 2025</a>.</div>
</footer>
</div>
